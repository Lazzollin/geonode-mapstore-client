(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[65292],{957043:(e,t,r)=>{var i=r(862488),o=r(121078),n=r(200278),s=r(701469);e.exports=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],a=e;a--;)t[a-1]=arguments[a];return i(s(r)?n(r):[r],o(t,1))}},869669:(e,t,r)=>{"use strict";r.d(t,{Z:()=>h});var i=r(421915),o=r(28795),n=r(432538),s=r(438667),a=function(e){function t(t,r,i){if(e.call(this),void 0!==i&&void 0===r)this.setFlatCoordinates(i,t);else{var o=r||0;this.setCenterAndRadius(t,o,i)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),void 0,this.layout)},t.prototype.closestPointXY=function(e,t,r,i){var o=this.flatCoordinates,n=e-o[0],s=t-o[1],a=n*n+s*s;if(a<i){if(0===a)for(var h=0;h<this.stride;++h)r[h]=o[h];else{var u=this.getRadius()/Math.sqrt(a);r[0]=o[0]+u*n,r[1]=o[1]+u*s;for(var l=2;l<this.stride;++l)r[l]=o[l]}return r.length=this.stride,a}return i},t.prototype.containsXY=function(e,t){var r=this.flatCoordinates,i=e-r[0],o=t-r[1];return i*i+o*o<=this.getRadiusSquared_()},t.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.computeExtent=function(e){var t=this.flatCoordinates,r=t[this.stride]-t[0];return(0,i.T9)(t[0]-r,t[1]-r,t[0]+r,t[1]+r,e)},t.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},t.prototype.getRadiusSquared_=function(){var e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t},t.prototype.getType=function(){return o.Z.CIRCLE},t.prototype.intersectsExtent=function(e){var t=this.getExtent();if((0,i.kK)(e,t)){var r=this.getCenter();return e[0]<=r[0]&&e[2]>=r[0]||e[1]<=r[1]&&e[3]>=r[1]||(0,i.H6)(e,this.intersectsCoordinate,this)}return!1},t.prototype.setCenter=function(e){var t=this.stride,r=this.flatCoordinates[t]-this.flatCoordinates[0],i=e.slice();i[t]=i[0]+r;for(var o=1;o<t;++o)i[t+o]=e[o];this.setFlatCoordinates(this.layout,i),this.changed()},t.prototype.setCenterAndRadius=function(e,t,r){this.setLayout(r,e,0),this.flatCoordinates||(this.flatCoordinates=[]);var i=this.flatCoordinates,o=(0,s.IG)(i,0,e,this.stride);i[o++]=i[0]+t;for(var n=1,a=this.stride;n<a;++n)i[o++]=i[n];i.length=o,this.changed()},t.prototype.getCoordinates=function(){return null},t.prototype.setCoordinates=function(e,t){},t.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()},t}(n.ZP);a.prototype.transform;const h=a},701577:(e,t,r)=>{"use strict";r.d(t,{Z:()=>P});var i=r(949179),o=r(378426),n=r(919629),s=r(623068),a=r(30006),h=r(179682),u=r(690728),l=r(613002),p=r(9520),d=r(173381),_=r(436403),c=r(421915),g=r(28795),f=r(752043),y=r(938024),v=r(429902),m=r(973410),x=r(925753),C=r(273101),E=r(831219),F=1,T="modifyend",S=function(e){function t(t,r,i){e.call(this,t),this.features=r,this.mapBrowserEvent=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(p.ZP);function L(e,t){return e.index-t.index}function I(e,t){var r=t.geometry;if(r.getType()===g.Z.CIRCLE){var i=r;if(t.index===F){var o=(0,u.bI)(i.getCenter(),e),n=Math.sqrt(o)-i.getRadius();return n*n}}return(0,u.Bs)(e,t.segment)}function G(e,t){var r=t.geometry;return r.getType()===g.Z.CIRCLE&&t.index===F?r.getClosestPoint(e):(0,u.oL)(e,t.segment)}const P=function(e){function t(t){var r,i;if(e.call(this,t),this.condition_=t.condition?t.condition:_.Xp,this.defaultDeleteCondition_=function(e){return(0,_.Ko)(e)&&(0,_.Kf)(e)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:_.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new C.Z,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new v.Z({source:new m.Z({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(r=(0,E.createEditingStyle)(),function(e,t){return r[g.Z.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,t.source?(this.source_=t.source,i=new o.Z(this.source_.getFeatures()),(0,l.oL)(this.source_,x.Z.ADDFEATURE,this.handleSourceAdd_,this),(0,l.oL)(this.source_,x.Z.REMOVEFEATURE,this.handleSourceRemove_,this)):i=t.features,!i)throw new Error("The modify interaction requires features or a source");this.features_=i,this.features_.forEach(this.addFeature_.bind(this)),(0,l.oL)(this.features_,n.Z.ADD,this.handleFeatureAdd_,this),(0,l.oL)(this.features_,n.Z.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature_=function(e){var t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),(0,l.oL)(e,d.Z.CHANGE,this.handleFeatureChange_,this)},t.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new S("modifystart",this.features_,e)))},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),(0,l.Ev)(e,d.Z.CHANGE,this.handleFeatureChange_,this)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach((function(t){e===t.feature&&r.push(t)}));for(var i=r.length-1;i>=0;--i)t.remove(r[i])},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},t.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),i={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),i)},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i){var n=r[i],s={feature:e,geometry:t,depth:[i],index:i,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length-1;i<o;++i){var n=r.slice(i,i+2),s={feature:e,geometry:t,index:i,segment:n};this.rBush_.insert((0,c.hI)(n),s)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var h=n.slice(s,s+2),u={feature:e,geometry:t,depth:[i],index:s,segment:h};this.rBush_.insert((0,c.hI)(h),u)}},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var h=n.slice(s,s+2),u={feature:e,geometry:t,depth:[i],index:s,segment:h};this.rBush_.insert((0,c.hI)(h),u)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length;s<a;++s)for(var h=n[s],u=0,l=h.length-1;u<l;++u){var p=h.slice(u,u+2),d={feature:e,geometry:t,depth:[s,i],index:u,segment:p};this.rBush_.insert((0,c.hI)(p),d)}},t.prototype.writeCircleGeometry_=function(e,t){var r=t.getCenter(),i={feature:e,geometry:t,index:0,segment:[r,r]},o={feature:e,geometry:t,index:F,segment:[r,r]},n=[i,o];i.featureSegments=o.featureSegments=n,this.rBush_.insert((0,c.HK)(r),i),this.rBush_.insert(t.getExtent(),o)},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),i=0;i<r.length;++i)this.SEGMENT_WRITERS_[r[i].getType()].call(this,e,r[i])},t.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new s.Z(new f.Z(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t)),t},t.prototype.handleEvent=function(t){return!t.pointerEvent||(this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=a.Z.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(r=!(t.type!=a.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==a.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),e.prototype.handleEvent.call(this,t)&&!r);var r},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);for(var t=e.coordinate,r=0,i=this.dragSegments_.length;r<i;++r){for(var o=this.dragSegments_[r],n=o[0],s=n.depth,a=n.geometry,h=void 0,l=n.segment,p=o[1];t.length<a.getStride();)t.push(l[p][t.length]);switch(a.getType()){case g.Z.POINT:h=t,l[0]=l[1]=t;break;case g.Z.MULTI_POINT:(h=a.getCoordinates())[n.index]=t,l[0]=l[1]=t;break;case g.Z.LINE_STRING:(h=a.getCoordinates())[n.index+p]=t,l[p]=t;break;case g.Z.MULTI_LINE_STRING:case g.Z.POLYGON:(h=a.getCoordinates())[s[0]][n.index+p]=t,l[p]=t;break;case g.Z.MULTI_POLYGON:(h=a.getCoordinates())[s[1]][s[0]][n.index+p]=t,l[p]=t;break;case g.Z.CIRCLE:l[0]=l[1]=t,0===n.index?(this.changingFeature_=!0,a.setCenter(t),this.changingFeature_=!1):(this.changingFeature_=!0,a.setRadius((0,u.TE)(a.getCenter(),t)),this.changingFeature_=!1)}h&&this.setGeometryCoordinates_(a,h)}this.createOrUpdateVertexFeature_(t)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);var t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0,this.modified_=!1;var r=this.vertexFeature_;if(r){var o=[],n=r.getGeometry().getCoordinates(),s=(0,c.hI)([n]),a=this.rBush_.getInExtent(s),h={};a.sort(L);for(var l=0,p=a.length;l<p;++l){var d=a[l],_=d.segment,f=(0,i.sq)(d.feature),y=d.depth;if(y&&(f+="-"+y.join("-")),h[f]||(h[f]=new Array(2)),d.geometry.getType()===g.Z.CIRCLE&&d.index===F){var v=G(t,d);(0,u.fS)(v,n)&&!h[f][0]&&(this.dragSegments_.push([d,0]),h[f][0]=d)}else if((0,u.fS)(_[0],n)&&!h[f][0])this.dragSegments_.push([d,0]),h[f][0]=d;else if((0,u.fS)(_[1],n)&&!h[f][1]){if((d.geometry.getType()===g.Z.LINE_STRING||d.geometry.getType()===g.Z.MULTI_LINE_STRING)&&h[f][0]&&0===h[f][0].index)continue;this.dragSegments_.push([d,1]),h[f][1]=d}else this.insertVertexCondition_(e)&&(0,i.sq)(_)in this.vertexSegments_&&!h[f][0]&&!h[f][1]&&o.push([d,n])}o.length&&this.willModifyFeatures_(e);for(var m=o.length-1;m>=0;--m)this.insertVertex_.apply(this,o[m])}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var t=this.dragSegments_.length-1;t>=0;--t){var r=this.dragSegments_[t][0],i=r.geometry;if(i.getType()===g.Z.CIRCLE){var o=i.getCenter(),n=r.featureSegments[0],s=r.featureSegments[1];n.segment[0]=n.segment[1]=o,s.segment[0]=s.segment[1]=o,this.rBush_.update((0,c.HK)(o),n),this.rBush_.update(i.getExtent(),s)}else this.rBush_.update((0,c.hI)(r.segment),r)}return this.modified_&&(this.dispatchEvent(new S(T,this.features_,e)),this.modified_=!1),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},t.prototype.handlePointerAtPixel_=function(e,t){var r=t.getCoordinateFromPixel(e),o=(0,c.f3)((0,c.HK)(r),t.getView().getResolution()*this.pixelTolerance_),n=this.rBush_.getInExtent(o);if(n.length>0){n.sort((function(e,t){return I(r,e)-I(r,t)}));var s=n[0],a=s.segment,h=G(r,s),l=t.getPixelFromCoordinate(h),p=(0,u.TE)(e,l);if(p<=this.pixelTolerance_){var d={};if(s.geometry.getType()===g.Z.CIRCLE&&s.index===F)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h);else{var _=t.getPixelFromCoordinate(a[0]),f=t.getPixelFromCoordinate(a[1]),y=(0,u.bI)(l,_),v=(0,u.bI)(l,f);p=Math.sqrt(Math.min(y,v)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(h=y>v?a[1]:a[0]),this.createOrUpdateVertexFeature_(h);for(var m=1,x=n.length;m<x;++m){var C=n[m].segment;if(!((0,u.fS)(a[0],C[0])&&(0,u.fS)(a[1],C[1])||(0,u.fS)(a[0],C[1])&&(0,u.fS)(a[1],C[0])))break;d[(0,i.sq)(C)]=!0}}return d[(0,i.sq)(a)]=!0,void(this.vertexSegments_=d)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,t){for(var r,i=e.segment,o=e.feature,n=e.geometry,s=e.depth,a=e.index;t.length<n.getStride();)t.push(0);switch(n.getType()){case g.Z.MULTI_LINE_STRING:case g.Z.POLYGON:(r=n.getCoordinates())[s[0]].splice(a+1,0,t);break;case g.Z.MULTI_POLYGON:(r=n.getCoordinates())[s[1]][s[0]].splice(a+1,0,t);break;case g.Z.LINE_STRING:(r=n.getCoordinates()).splice(a+1,0,t);break;default:return}this.setGeometryCoordinates_(n,r);var h=this.rBush_;h.remove(e),this.updateSegmentIndices_(n,a,s,1);var u={segment:[i[0],t],feature:o,geometry:n,depth:s,index:a};h.insert((0,c.hI)(u.segment),u),this.dragSegments_.push([u,1]);var l={segment:[t,i[1]],feature:o,geometry:n,depth:s,index:a+1};h.insert((0,c.hI)(l.segment),l),this.dragSegments_.push([l,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=a.Z.POINTERDRAG){var e=this.lastPointerEvent_;return this.willModifyFeatures_(e),this.removeVertex_(),this.dispatchEvent(new S(T,this.features_,e)),this.modified_=!1,!0}return!1},t.prototype.removeVertex_=function(){var e,t,r,o,n,s,a,h,u,l,p,d=this.dragSegments_,_={},f=!1;for(n=d.length-1;n>=0;--n)l=(r=d[n])[0],p=(0,i.sq)(l.feature),l.depth&&(p+="-"+l.depth.join("-")),p in _||(_[p]={}),0===r[1]?(_[p].right=l,_[p].index=l.index):1==r[1]&&(_[p].left=l,_[p].index=l.index+1);for(p in _){switch(u=_[p].right,a=_[p].left,(h=(s=_[p].index)-1)<0&&(h=0),e=t=(o=(l=void 0!==a?a:u).geometry).getCoordinates(),f=!1,o.getType()){case g.Z.MULTI_LINE_STRING:t[l.depth[0]].length>2&&(t[l.depth[0]].splice(s,1),f=!0);break;case g.Z.LINE_STRING:t.length>2&&(t.splice(s,1),f=!0);break;case g.Z.MULTI_POLYGON:e=e[l.depth[1]];case g.Z.POLYGON:(e=e[l.depth[0]]).length>4&&(s==e.length-1&&(s=0),e.splice(s,1),f=!0,0===s&&(e.pop(),e.push(e[0]),h=e.length-1))}if(f){this.setGeometryCoordinates_(o,t);var y=[];if(void 0!==a&&(this.rBush_.remove(a),y.push(a.segment[0])),void 0!==u&&(this.rBush_.remove(u),y.push(u.segment[1])),void 0!==a&&void 0!==u){var v={depth:l.depth,feature:l.feature,geometry:l.geometry,index:h,segment:y};this.rBush_.insert((0,c.hI)(v.segment),v)}this.updateSegmentIndices_(o,s,l.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.length=0}}return f},t.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,t,r,i){this.rBush_.forEachInExtent(e.getExtent(),(function(o){o.geometry===e&&(void 0===r||void 0===o.depth||(0,h.fS)(o.depth,r))&&o.index>t&&(o.index+=i)}))},t}(y.Z)},51273:(e,t,r)=>{"use strict";r.d(t,{Z:()=>v});var i=r(949179),o=r(919629),n=r(179682),s=r(613002),a=r(9520),h=r(436403),u=r(864011),l=r(28795),p=r(247588),d=r(429902),_=r(913580),c=r(973410),g=r(831219),f=function(e){function t(t,r,i,o){e.call(this,t),this.selected=r,this.deselected=i,this.mapBrowserEvent=o}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(a.ZP);function y(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),r=this.removeCondition_(e),i=this.toggleCondition_(e),o=!t&&!r&&!i,s=e.map,a=this.getFeatures(),u=[],l=[];if(o){(0,_.ZH)(this.featureLayerAssociation_),s.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return l.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var p=a.getLength()-1;p>=0;--p){var d=a.item(p),c=l.indexOf(d);c>-1?l.splice(c,1):(a.remove(d),u.push(d))}0!==l.length&&a.extend(l)}else{s.forEachFeatureAtPixel(e.pixel,function(e,o){if(this.filter_(e,o))return!t&&!i||(0,n.q9)(a.getArray(),e)?(r||i)&&(0,n.q9)(a.getArray(),e)&&(u.push(e),this.removeFeatureLayerAssociation_(e)):(l.push(e),this.addFeatureLayerAssociation_(e,o)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var g=u.length-1;g>=0;--g)a.remove(u[g]);a.extend(l)}return(l.length>0||u.length>0)&&this.dispatchEvent(new f("select",l,u,e)),(0,h.MJ)(e)}const v=function(e){function t(t){e.call(this,{handleEvent:y});var r=t||{};this.condition_=r.condition?r.condition:h.Kf,this.addCondition_=r.addCondition?r.addCondition:h.Fi,this.removeCondition_=r.removeCondition?r.removeCondition:h.Fi,this.toggleCondition_=r.toggleCondition?r.toggleCondition:h.vY,this.multi_=!!r.multi&&r.multi,this.filter_=r.filter?r.filter:u.uX,this.hitTolerance_=r.hitTolerance?r.hitTolerance:0;var i,a,p=new d.Z({source:new c.Z({useSpatialIndex:!1,features:r.features,wrapX:r.wrapX}),style:r.style?r.style:(a=(0,g.createEditingStyle)(),(0,n.l7)(a[l.Z.POLYGON],a[l.Z.LINE_STRING]),(0,n.l7)(a[l.Z.GEOMETRY_COLLECTION],a[l.Z.LINE_STRING]),function(e,t){return e.getGeometry()?a[e.getGeometry().getType()]:null}),updateWhileAnimating:!0,updateWhileInteracting:!0});if(this.featureOverlay_=p,r.layers)if("function"==typeof r.layers)i=r.layers;else{var _=r.layers;i=function(e){return(0,n.q9)(_,e)}}else i=u.uX;this.layerFilter_=i,this.featureLayerAssociation_={};var f=this.getFeatures();(0,s.oL)(f,o.Z.ADD,this.addFeature_,this),(0,s.oL)(f,o.Z.REMOVE,this.removeFeature_,this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeatureLayerAssociation_=function(e,t){this.featureLayerAssociation_[(0,i.sq)(e)]=t},t.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.getLayer=function(e){return this.featureLayerAssociation_[(0,i.sq)(e)]},t.prototype.getOverlay=function(){return this.featureOverlay_},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){var r=this.getMap(),i=this.getFeatures();r&&i.forEach(r.unskipFeature.bind(r)),e.prototype.setMap.call(this,t),this.featureOverlay_.setMap(t),t&&i.forEach(t.skipFeature.bind(t))},t.prototype.addFeature_=function(e){var t=this.getMap();t&&t.skipFeature(e.element)},t.prototype.removeFeature_=function(e){var t=this.getMap();t&&t.unskipFeature(e.element)},t.prototype.removeFeatureLayerAssociation_=function(e){delete this.featureLayerAssociation_[(0,i.sq)(e)]},t}(p.ZP)},650141:(e,t,r)=>{"use strict";r.d(t,{Z:()=>v});var i=r(949179),o=r(919629),n=r(690728),s=r(613002),a=r(173381),h=r(421915),u=r(864011),l=r(28795),p=r(15265),d=r(938024),_=r(913580),c=r(925753),g=r(273101);function f(e){return e.feature?e.feature:e.element?e.element:void 0}function y(e,t){return(0,n.Bs)(this.pixelCoordinate_,e.segment)-(0,n.Bs)(this.pixelCoordinate_,t.segment)}const v=function(e){function t(t){var r=t||{},i=r;i.handleDownEvent||(i.handleDownEvent=u.uX),i.stopDown||(i.stopDown=u.Dv),e.call(this,i),this.source_=r.source?r.source:null,this.vertex_=void 0===r.vertex||r.vertex,this.edge_=void 0===r.edge||r.edge,this.features_=r.features?r.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelCoordinate_=null,this.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,this.sortByDistance_=y.bind(this),this.rBush_=new g.Z,this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.addFeature=function(e,t){var r=void 0===t||t,o=(0,i.sq)(e),n=e.getGeometry();if(n){var u=this.SEGMENT_WRITERS_[n.getType()];u&&(this.indexedFeaturesExtents_[o]=n.getExtent((0,h.lJ)()),u.call(this,e,n))}r&&(this.featureChangeListenerKeys_[o]=(0,s.oL)(e,a.Z.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(t){var r=this.snapTo(t.pixel,t.coordinate,t.map);return r.snapped&&(t.coordinate=r.vertex.slice(0,2),t.pixel=r.vertexPixel),e.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(e){var t=f(e);this.addFeature(t)},t.prototype.handleFeatureRemove_=function(e){var t=f(e);this.removeFeature(t)},t.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var r=(0,i.sq)(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)},t.prototype.handleUpEvent=function(e){var t=(0,_.KX)(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var r=void 0===t||t,o=(0,i.sq)(e),n=this.indexedFeaturesExtents_[o];if(n){var a=this.rBush_,h=[];a.forEachInExtent(n,(function(t){e===t.feature&&h.push(t)}));for(var u=h.length-1;u>=0;--u)a.remove(h[u])}r&&((0,s.bN)(this.featureChangeListenerKeys_[o]),delete this.featureChangeListenerKeys_[o])},t.prototype.setMap=function(t){var r=this.getMap(),i=this.featuresListenerKeys_,n=this.getFeatures_();r&&(i.forEach(s.bN),i.length=0,n.forEach(this.forEachFeatureRemove_.bind(this))),e.prototype.setMap.call(this,t),t&&(this.features_?i.push((0,s.oL)(this.features_,o.Z.ADD,this.handleFeatureAdd_,this),(0,s.oL)(this.features_,o.Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push((0,s.oL)(this.source_,c.Z.ADDFEATURE,this.handleFeatureAdd_,this),(0,s.oL)(this.source_,c.Z.REMOVEFEATURE,this.handleFeatureRemove_,this)),n.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,t,r){var i=r.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),o=r.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),s=(0,h.hI)([i,o]),a=this.rBush_.getInExtent(s);this.vertex_&&!this.edge_&&(a=a.filter((function(e){return e.feature.getGeometry().getType()!==l.Z.CIRCLE})));var u,p,d,_,c=!1,g=null,f=null;if(a.length>0){this.pixelCoordinate_=t,a.sort(this.sortByDistance_);var y=a[0].segment,v=a[0].feature.getGeometry().getType()===l.Z.CIRCLE;this.vertex_&&!this.edge_?(u=r.getPixelFromCoordinate(y[0]),p=r.getPixelFromCoordinate(y[1]),d=(0,n.bI)(e,u),_=(0,n.bI)(e,p),Math.sqrt(Math.min(d,_))<=this.pixelTolerance_&&(c=!0,g=d>_?y[1]:y[0],f=r.getPixelFromCoordinate(g))):this.edge_&&(g=v?(0,n.Ed)(t,a[0].feature.getGeometry()):(0,n.oL)(t,y),f=r.getPixelFromCoordinate(g),(0,n.TE)(e,f)<=this.pixelTolerance_&&(c=!0,this.vertex_&&!v&&(u=r.getPixelFromCoordinate(y[0]),p=r.getPixelFromCoordinate(y[1]),d=(0,n.bI)(f,u),_=(0,n.bI)(f,p),Math.sqrt(Math.min(d,_))<=this.pixelTolerance_&&(g=d>_?y[1]:y[0],f=r.getPixelFromCoordinate(g))))),c&&(f=[Math.round(f[0]),Math.round(f[1])])}return{snapped:c,vertex:g,vertexPixel:f}},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.writeCircleGeometry_=function(e,t){for(var r=(0,p.Bb)(t).getCoordinates()[0],i=0,o=r.length-1;i<o;++i){var n=r.slice(i,i+2),s={feature:e,segment:n};this.rBush_.insert((0,h.hI)(n),s)}},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),i=0;i<r.length;++i){var o=this.SEGMENT_WRITERS_[r[i].getType()];o&&o.call(this,e,r[i])}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length-1;i<o;++i){var n=r.slice(i,i+2),s={feature:e,segment:n};this.rBush_.insert((0,h.hI)(n),s)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var u=n.slice(s,s+2),l={feature:e,segment:u};this.rBush_.insert((0,h.hI)(u),l)}},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i){var n=r[i],s={feature:e,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length;s<a;++s)for(var u=n[s],l=0,p=u.length-1;l<p;++l){var d=u.slice(l,l+2),_={feature:e,segment:d};this.rBush_.insert((0,h.hI)(d),_)}},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),i={feature:e,segment:[r,r]};this.rBush_.insert(t.getExtent(),i)},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),i=0,o=r.length;i<o;++i)for(var n=r[i],s=0,a=n.length-1;s<a;++s){var u=n.slice(s,s+2),l={feature:e,segment:u};this.rBush_.insert((0,h.hI)(u),l)}},t}(d.Z)},829194:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var i=r(378426),o=r(558493),n=r(613002),s=r(9520),a=r(864011),h=r(179682),u=r(938024),l=r(173604),p=function(e){function t(t,r,i){e.call(this,t),this.features=r,this.coordinate=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(s.ZP);const d=function(e){function t(t){var r,i=t||{};if(e.call(this,i),this.lastCoordinate_=null,this.features_=void 0!==i.features?i.features:null,i.layers)if("function"==typeof i.layers)r=i.layers;else{var s=i.layers;r=function(e){return(0,h.q9)(s,e)}}else r=a.uX;this.layerFilter_=r,this.hitTolerance_=i.hitTolerance?i.hitTolerance:0,this.lastFeature_=null,(0,n.oL)(this,(0,o.v_)(l.Z.ACTIVE),this.handleActiveChanged_,this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.handleDownEvent=function(e){if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);var t=this.features_||new i.Z([this.lastFeature_]);return this.dispatchEvent(new p("translatestart",t,e.coordinate)),!0}return!1},t.prototype.handleUpEvent=function(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);var t=this.features_||new i.Z([this.lastFeature_]);return this.dispatchEvent(new p("translateend",t,e.coordinate)),!0}return!1},t.prototype.handleDragEvent=function(e){if(this.lastCoordinate_){var t=e.coordinate,r=t[0]-this.lastCoordinate_[0],o=t[1]-this.lastCoordinate_[1],n=this.features_||new i.Z([this.lastFeature_]);n.forEach((function(e){var t=e.getGeometry();t.translate(r,o),e.setGeometry(t)})),this.lastCoordinate_=t,this.dispatchEvent(new p("translating",n,t))}},t.prototype.handleMoveEvent=function(e){var t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")},t.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){if(!this.features_||(0,h.q9)(this.features_.getArray(),e))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){var r=this.getMap();e.prototype.setMap.call(this,t),this.updateState_(r)},t.prototype.handleActiveChanged_=function(){this.updateState_(null)},t.prototype.updateState_=function(e){var t=this.getMap(),r=this.getActive();t&&r||(t=t||e)&&t.getViewport().classList.remove("ol-grab","ol-grabbing")},t}(u.Z)}}]);