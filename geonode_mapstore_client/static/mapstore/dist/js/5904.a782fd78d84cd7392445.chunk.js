(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[5904],{505904:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Y});var n=r(124852),o=r.n(n),a=r(675263),s=r.n(a),l=r(59854),i=r.n(l),u=r(227361),p=r.n(u),m=r(618446),c=r.n(m),g=r(843624),d=r.n(g),f=r(610928),y=r.n(f),v=r(414293),h=r.n(v),b=r(719824),L=r(808797),O=r(761868),T=r(393546),E=r(86638),w=r(838946),P=r(944538),S=r(15265),j=r(193409),M=r(973410),x=r(429902),C=r(623068),I=r(831219),A=r(898185),D=r(120767),V=r(409371),F=r(372445),G=r(169141),k=r(756834),B=r(870295),N=["textId","type"];function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){K(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e){return function(e){if(Array.isArray(e))return U(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||z(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){if(e){if("string"==typeof e)return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?U(e,t):void 0}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Q(n.key),n)}}function W(e,t){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},W(e,t)}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function K(e,t,r){return(t=Q(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q(e){var t=function(e,t){if("object"!==Z(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Z(t)?t:String(t)}var X=function(e){return e.getView().getProjection().getCode()},Y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&W(e,t)}(s,e);var t,r,n,o,a=(n=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(n);if(o){var r=q(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return J(e)}(this,e)});function s(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return K(J(e=a.call.apply(a,[this].concat(r))),"getLength",(function(t,r){if("Bearing"===r.measurement.geomType&&t.length>1)return(0,b.calculateAzimuth)(t[0],t[1],X(r.map));var n=e.reprojectedCoordinatesIn4326(t);return(0,b.calculateDistance)(n,r.measurement.lengthFormula)})),K(J(e),"getArea",(function(t){return e.calculateGeodesicArea(t.getLinearRing(0).getCoordinates())})),K(J(e),"cleanupMeasures",(function(){e.removeDrawInteraction(),e.removeMeasureTooltips(),e.removeSegmentLengthOverlays(),e.textLabels=[],e.segmentLengths=[],e.props.map.removeLayer(e.measureLayer),e.vector=null,e.measureLayer=null,e.source&&(e.source.clear(),e.source=null)})),K(J(e),"updateInteraction",(function(t,r){r.some((function(e){return p()(e,"properties.disabled")}))?e.removeDrawInteraction():null===e.drawInteraction&&(e.restoreDrawState(),e.addDrawInteraction(t))})),K(J(e),"convertPolyToLineFeature",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=[],n=(0,L.wd)(t[0]);return n&&(0,L.wd)(t[1])?r=e.reprojectedCoordinatesFrom4326([t[0],t[1]]):n&&(r=e.reprojectedCoordinatesFrom4326([t[0]])),r.length?new P.Z(r):null})),K(J(e),"modifyFeatures",(function(t){var r,n,o,a,s,l=t.measurement||{},i=l.currentFeature,u=l.features,p=(null===(r=u[i])||void 0===r||null===(n=r.geometry)||void 0===n?void 0:n.coordinates)||[],m=(null===(o=u[i])||void 0===o||null===(a=o.geometry)||void 0===a?void 0:a.type)||"";"Polygon"===m&&(p=(null===(s=p)||void 0===s?void 0:s[0])||[]);var g,d,f,y,v,h,b=p.length,T=p.some((function(e){return!(0,L.wd)(e)}));if(!T&&"LineString"===m&&b<2){var E=e.reprojectedCoordinatesFrom4326(p);g=new P.Z(E),u[i]=(0,O.t8)("properties.disabled",!0,(0,O.t8)("geometry.coordinates",[].concat(R(p),[["",""]]),u[i]))}else!T&&"Polygon"===m&&b<=4&&c()(p[b-1],p[b-2])&&(p.splice(2,0,["",""]),p.pop(),u[i]=(0,O.t8)("properties.disabled",!0,(0,O.t8)("geometry.coordinates",[p],u[i])));return"Polygon"===m&&b<=4&&(g=e.convertPolyToLineFeature(p)),!T&&c()(p[b-1],p[b-2])&&(null===(d=u[i])||void 0===d||null===(f=d.geometry)||void 0===f||null===(y=f.coordinates)||void 0===y||null===(v=y[0])||void 0===v||v.pop()),g&&(e.source.clear(),h=new C.Z({geometry:g})),[u,h]})),K(J(e),"updateFeatures",(function(t){var r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,s,l=[],i=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=a.call(r)).done)&&(l.push(n.value),l.length!==t);i=!0);}catch(e){u=!0,o=e}finally{try{if(!i&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return l}}(e,t)||z(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.modifyFeatures(t)||[],2),n=r[0],o=r[1],a=e.source.getFeatures();e.removeMeasureTooltips(),e.removeSegmentLengthOverlays(),e.source.clear(),e.textLabels=[],e.segmentLengths=[];var s=null;e.updateInteraction(t,n);var l=n.map((function(r,n){if(p()(r,"properties.disabled"))return s=n,[r,a&&a[n]&&a[n].getGeometry()||(null==o?void 0:o.getGeometry())];var l=r.geometry.type,i=p()(r,"properties.values",[]),u="bearing"===(i[0]||{}).type||!(i[0]||{}).type&&t.measurement.bearingMeasureEnabled,m="Polygon"===l?r.geometry.coordinates[0]:r.geometry.coordinates,c=m;"LineString"===l&&m.length>=2&&!u&&(c=(0,b.transformLineToArcs)(m));var g=e.reprojectedCoordinatesFrom4326(c),d="Polygon"===l?new S.ZP([g]):new P.Z(g),f={Point:function(){return m},LineString:function(){return u?(0,b.calculateAzimuth)(m[0],m[1],"EPSG:4326"):(0,b.calculateDistance)(m,t.measurement.lengthFormula)},Polygon:function(){return e.getArea(d)}},v={LineString:function(){return e.formatLengthValue(u?(0,b.calculateAzimuth)(m[0],m[1],"EPSG:4326"):(0,b.calculateDistance)(m,t.measurement.lengthFormula),t.uom,u,t.measurement.trueBearing)},Polygon:function(){return e.formatAreaValue(e.getArea(d),t.uom)}},h=e.reprojectedCoordinatesFrom4326(m);if(!u)for(var O=0;O<m.length-1;++O){e.createSegmentLengthOverlay();var T=(0,b.calculateAzimuth)(m[O],m[O+1],"EPSG:4326"),E=(0,b.calculateDistance)([m[O],m[O+1]],t.measurement.lengthFormula),w=e.props.measurement&&e.props.measurement.showLengthAndBearingLabel&&" | "+(0,L.rp)(T,e.props.measurement.trueBearing)||"",j=e.formatLengthValue(E,t.uom,u)+w;y()(e.segmentOverlayElements).innerHTML=j;var M=(0,b.midpoint)(m[O],m[O+1],!0),x=(0,b.midpoint)(h[O],h[O+1],!0);if("LineString"===l){var C=c[100*O+50];C&&(M=C,x=(0,b.pointObjectToArray)((0,b.reproject)(C,"EPSG:4326",X(e.props.map))))}y()(e.segmentOverlays).setPosition(x),e.textLabels[e.segmentOverlays.length-1]={text:j,position:M},e.segmentLengths[e.segmentOverlays.length-1]={value:E,type:u?"bearing":"length"}}if(e.createMeasureTooltip(),"Polygon"===l&&e.createMeasureTooltip(),e.tooltipCoord="LineString"===l?y()(h):e.tooltipCoord=d.getInteriorPoint().getCoordinates(),y()(e.measureTooltipElements).innerHTML=v[l](),y()(e.measureTooltips).setPosition(e.tooltipCoord),e.outputValues[e.measureTooltipElements.length-1]={value:f[l](),type:"Polygon"===l?"area":u?"bearing":"length"},"Polygon"===l){var I=(0,b.calculateDistance)(m,t.measurement.lengthFormula);e.measureTooltipElements[e.measureTooltipElements.length-2].innerHTML=e.formatLengthValue(I,t.uom,!1),e.outputValues[e.measureTooltipElements.length-2]={value:I,type:"length"},e.perimeterTooltipCoord=y()(h),e.measureTooltips[e.measureTooltipElements.length-2].setPosition(e.perimeterTooltipCoord),e.measureTooltips[e.measureTooltipElements.length-2].setOffset([0,-7])}var A=_({},r);return A.properties=r.properties?_({},r.properties):{},A.properties.values=[{value:(f[l]||function(){return null})(),formattedValue:(v[l]||function(){return null})(),position:"Polygon"===l?(0,b.pointObjectToArray)((0,b.reproject)(d.getInteriorPoint().getCoordinates(),X(t.map),"EPSG:4326")):y()(m),type:(i[0]||{}).type||(t.measurement.pointMeasureEnabled?"point":t.measurement.lineMeasureEnabled?"length":t.measurement.areaMeasureEnabled?"area":t.measurement.bearingMeasureEnabled?"bearing":void 0)}].concat(R("Polygon"===l?[{value:(0,b.calculateDistance)(m,t.measurement.lengthFormula),formattedValue:e.formatLengthValue((0,b.calculateDistance)(m,t.measurement.lengthFormula),t.uom,!1),position:y()(m),uom:t.uom,type:"length"}]:[])),[A,d]})),i=l.map((function(e){return e[0]})),u=l.map((function(e){return e[1]}));e.source.addFeatures(u.filter((function(e){return!!e})).map((function(e){return new C.Z({geometry:e})})));var m=R(e.textLabels);i.map((function(e,t){var r,n,o=!(null===(r=e.properties)||void 0===r||null===(n=r.values)||void 0===n||!n.find((function(e){return"bearing"===e.type}))),a="Polygon"===e.geometry.type,l=a||o?0:1,i=a?e.geometry.coordinates[0]:e.geometry.coordinates,u=i.some((function(e){return!(0,L.wd)(e)})),p=a?i.length-1:o?0:i.length;return e.geometry.textLabels=null!==s&&s===t&&u?e.geometry.textLabels.concat([{text:"0"}]):m.splice(0,p-l)||[],e})),e.props.changeGeometry(i),e.props.setTextLabels(R(e.textLabels));for(var c=0;c<e.measureTooltipElements.length;++c)e.measureTooltipElements[c]&&(e.measureTooltipElements[c].className="tooltip tooltip-static");for(var g=0;g<e.segmentOverlayElements.length;++g)e.segmentOverlayElements[g]&&(e.segmentOverlayElements[g].className="segment-overlay segment-overlay-static")})),K(J(e),"updateMeasures",(function(t){var r=function(r){var n=r.type,o=r.value;return"length"===n?e.formatLengthValue(o,t.uom,!1):"area"===n?e.formatAreaValue(o,t.uom):e.formatLengthValue(o,t.uom,!0,t.measurement.trueBearing)};e.outputValues=e.outputValues||[],e.segmentOverlayElements=e.segmentOverlayElements||[],e.textLabels=e.textLabels||[];for(var n=0;n<e.outputValues.length;++n)e.outputValues[n]&&(e.measureTooltipElements[n].innerHTML=r(e.outputValues[n]));for(var o=0;o<e.segmentOverlayElements.length;++o)if(e.segmentOverlayElements[o]){var a=r(e.segmentLengths[o]),s=e.textLabels[o].text,l=s.indexOf(" | ");s=s.replace(s.substring(0,-1!==l?l:s.length),a),e.segmentOverlayElements[o].innerHTML=s,e.textLabels[o].text=s}e.drawing||e.props.setTextLabels(R(e.textLabels));var i=(t.measurement.features||[]).map((function(e){return _(_({},e),e.properties?{properties:_(_({},e.properties),{},{values:(e.properties.values||[]).map((function(e){return _(_({},e),{},{formattedValue:r({type:e.type,value:e.value})})}))})}:{})}));e.props.changeGeometry(i)})),K(J(e),"addFeature",(function(t){var r=!1;e.source||(e.source=new M.Z,r=!0);var n=(0,b.reprojectGeoJson)(t,"EPSG:4326",X(e.props.map)).geometry,o=new C.Z({geometry:(0,w.y7)(n)});e.source.addFeature(o),r&&e.measureLayer.setSource(e.source)})),K(J(e),"resetGeometry",(function(){e.source.clear(),e.props.resetGeometry()})),K(J(e),"saveDrawState",(function(){var t,r,n,o;e.savedDrawState={textLabels:e.textLabels.slice(),segmentLengths:e.segmentLengths.slice(),measureTooltipsLength:null!==(t=null===(r=e.measureTooltips)||void 0===r?void 0:r.length)&&void 0!==t?t:0,segmentOverlaysLength:null!==(n=null===(o=e.segmentOverlays)||void 0===o?void 0:o.length)&&void 0!==n?n:0}})),K(J(e),"discardDrawState",(function(){e.savedDrawState=null})),K(J(e),"restoreDrawState",(function(){if(e.savedDrawState){e.textLabels=e.savedDrawState.textLabels,e.segmentLengths=e.savedDrawState.segmentLengths;for(var t=e.savedDrawState.measureTooltipsLength;t<e.measureTooltips.length;++t)e.props.map.removeOverlay(e.measureTooltips[t]),e.measureTooltipElements[t].parentNode.removeChild(e.measureTooltipElements[t]);for(var r=e.savedDrawState.segmentOverlaysLength;r<e.segmentOverlays.length;++r)e.props.map.removeOverlay(e.segmentOverlays[r]),e.segmentOverlayElements[r].parentNode.removeChild(e.segmentOverlayElements[r]);e.measureTooltips.splice(e.savedDrawState.measureTooltipsLength),e.measureTooltipElements.splice(e.savedDrawState.measureTooltipsLength),e.outputValues.splice(e.savedDrawState.measureTooltipsLength),e.segmentOverlays.splice(e.savedDrawState.segmentOverlaysLength),e.segmentOverlayElements.splice(e.savedDrawState.segmentOverlaysLength),e.curPolygonLength=void 0,e.curLineStringLength=void 0,e.savedDrawState=null}})),K(J(e),"addDrawInteraction",(function(t){var r,n,o=t.measurement.startEndPoint;if(e.continueLineMsg=(0,E.S$)(e.context.messages,"measureSupport.continueLine"),e.continuePolygonMsg=(0,E.S$)(e.context.messages,"measureSupport.continuePolygon"),e.drawInteraction&&e.removeDrawInteraction(),!e.vector){e.source=new M.Z;var a=[new I.default({fill:new A.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new D.default({color:"#ffcc33",width:2}),image:new V.default({radius:7,fill:new A.default({color:"#ffcc33"})})})],s=[],l=o||!0===o;if(l||void 0===o){var i=l?void 0===o?{}:o:t.startEndPoint;s=(0,T.rm)(i.startPointOptions,i.endPointOptions)}var u=[].concat(a,R(s));e.vector=new x.Z({source:e.source,zIndex:1e6,style:u}),e.props.map.addLayer(e.vector)}n="Bearing"===t.measurement.geomType?"LineString":t.measurement.geomType,r=new F.ZP({source:new M.Z,type:n,style:new I.default({fill:new A.default({color:"rgba(255, 255, 255, 0.2)"}),stroke:new D.default({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new V.default({radius:5,stroke:new D.default({color:"rgba(0, 0, 0, 0.7)"}),fill:new A.default({color:"rgba(255, 255, 255, 0.2)"})})})}),e.clickListener=e.props.map.on("click",(function(){return e.updateMeasurementResults(e.props)})),e.props.updateOnMouseMove&&e.props.map.on("pointermove",(function(){return e.updateMeasurementResults(e.props)})),e.props.map.on("pointermove",(function(t){return e.pointerMoveHandler(t)})),r.on("drawstart",(function(t){var r,n;e.sketchFeature=t.feature,e.drawing=!0,e.textId=(null===(r=e.props.measurement)||void 0===r||null===(n=r.features)||void 0===n?void 0:n.length)||0,e.textLabels||(e.textLabels=[]),e.segmentLengths||(e.segmentLengths=[]),e.props.measurement.disableLabels||(e.saveDrawState(),e.createMeasureTooltip("Polygon"===e.props.measurement.geomType?[0,0]:void 0),"Polygon"===e.props.measurement.geomType&&e.createMeasureTooltip(),"Polygon"===e.props.measurement.geomType&&e.createSegmentLengthOverlay()),e.listener=e.sketchFeature.getGeometry().on("change",(function(t){var r,n,o=t.target;if(o instanceof S.ZP){n={value:e.getArea(o),type:"area"},r=e.formatAreaValue(n.value,e.props.uom),e.tooltipCoord=o.getInteriorPoint().getCoordinates();var a=o.getCoordinates()[0],s=[];if(!e.props.measurement.disableLabels&&((void 0===e.curPolygonLength||e.curPolygonLength<a.length)&&(e.createSegmentLengthOverlay(),e.curPolygonLength=a.length),a.length>2)){s.push((0,b.midpoint)(a[a.length-1],a[a.length-2],!0)),s.push((0,b.midpoint)(a[a.length-2],a[a.length-3],!0));for(var l=0;l<s.length;++l){var i=a.slice(a.length-2-l,a.length-l),u=e.getLength(i,e.props),p=e.props.measurement&&e.props.measurement.showLengthAndBearingLabel&&" | "+(0,L.rp)((0,b.calculateAzimuth)(i[0],i[1],X(e.props.map)),e.props.measurement.trueBearing)||"",m=e.formatLengthValue(u,e.props.uom,!1)+p;e.segmentOverlayElements[e.segmentOverlays.length-l-1].innerHTML=m,e.segmentOverlays[e.segmentOverlays.length-l-1].setPosition(s[l]),e.segmentLengths[e.segmentOverlays.length-l-1]={value:u,type:"length"},e.textLabels[e.segmentOverlays.length-l-1]={text:m,position:(0,b.pointObjectToArray)((0,b.reproject)(s[l],X(e.props.map),"EPSG:4326")),type:e.props.measurement.geomType,textId:e.textId}}}}else if(o instanceof P.Z){var c=o.getCoordinates(),g=[c[c.length-2],c[c.length-1]];e.props.measurement.disableLabels||e.props.measurement.bearingMeasureEnabled||!(void 0===e.curLineStringLength||e.curLineStringLength<c.length)||(e.createSegmentLengthOverlay(),e.curLineStringLength=c.length);var f=e.getLength(c,e.props),v=e.getLength(g,e.props);if(r=e.formatLengthValue(f,e.props.uom,"Bearing"===e.props.measurement.geomType,e.props.measurement.trueBearing),e.tooltipCoord=o.getLastCoordinate(),!e.props.measurement.disableLabels&&!e.props.measurement.bearingMeasureEnabled){var h=e.props.measurement&&e.props.measurement.showLengthAndBearingLabel&&" | "+(0,L.rp)((0,b.calculateAzimuth)(g[0],g[1],X(e.props.map)),e.props.measurement.trueBearing)||"",O=e.formatLengthValue(v,e.props.uom,"Bearing"===e.props.measurement.geomType,e.props.measurement.trueBearing)+h;y()(e.segmentOverlayElements).innerHTML=O,y()(e.segmentOverlays).setPosition((0,b.midpoint)(g[0],g[1],!0)),e.textLabels[e.segmentOverlays.length-1]={text:O,position:(0,b.pointObjectToArray)((0,b.reproject)((0,b.midpoint)(g[0],g[1],!0),X(e.props.map),"EPSG:4326")),type:e.props.measurement.geomType,textId:e.textId},e.segmentLengths[e.segmentOverlays.length-1]={value:v,type:"Bearing"===e.props.measurement.geomType?"bearing":"length"}}n={value:f,type:"Bearing"===e.props.measurement.geomType?"bearing":"length"}}if(!e.props.measurement.disableLabels&&(y()(e.measureTooltipElements).innerHTML=r,y()(e.measureTooltips).setPosition(e.tooltipCoord),e.outputValues[e.outputValues.length-1]=n,o instanceof S.ZP)){var T=o.getCoordinates()[0],E=e.getLength(3===T.length?d()(T):T,e.props);e.measureTooltipElements[e.measureTooltipElements.length-2].innerHTML=e.formatLengthValue(E,e.props.uom,!1),e.outputValues[e.measureTooltipElements.length-2]={value:E,type:"length"},e.perimeterTooltipCoord=o.getLastCoordinate(),e.measureTooltips[e.measureTooltipElements.length-2].setPosition(e.perimeterTooltipCoord)}}))})),r.on("drawend",(function(t){var r;e.drawing=!1;var n=p()(e.props.measurement,"features",[]),o=t.feature.getGeometry(),a=o.getCoordinates(),s=new G.Z,l={Point:function(){return(0,b.reproject)(a,X(e.props.map),"EPSG:4326")},LineString:function(){return e.getLength(a,e.props)},Polygon:function(){return e.getArea(o)},Bearing:function(){return(0,b.calculateAzimuth)(a[0],a[1],X(e.props.map))}},i={LineString:function(){return e.formatLengthValue(e.getLength(a,e.props),e.props.uom,!1)},Polygon:function(){return e.formatAreaValue(e.getArea(o),e.props.uom)},Bearing:function(){return e.formatLengthValue((0,b.calculateAzimuth)(a[0],a[1],X(e.props.map)),e.props.uom,!0,e.props.measurement.trueBearing)}},u=(0,b.reprojectGeoJson)(s.writeFeatureObject(t.feature.clone()),X(e.props.map),"EPSG:4326");u.properties=u.properties||{},u.properties.values=[{value:(l[e.props.measurement.geomType]||function(){return null})(),formattedValue:(i[e.props.measurement.geomType]||function(){return null})(),position:(0,b.pointObjectToArray)((0,b.reproject)("Polygon"===e.props.measurement.geomType?o.getInteriorPoint().getCoordinates():y()(a),X(e.props.map),"EPSG:4326")),type:e.props.measurement.pointMeasureEnabled?"point":e.props.measurement.lineMeasureEnabled?"length":e.props.measurement.areaMeasureEnabled?"area":e.props.measurement.bearingMeasureEnabled?"bearing":void 0}].concat(R("Polygon"===e.props.measurement.geomType?[{value:(e.outputValues[e.measureTooltipElements.length-2]||{}).value||0,formattedValue:e.formatLengthValue((e.outputValues[e.measureTooltipElements.length-2]||{}).value||0,e.props.uom,!1),position:(0,b.pointObjectToArray)((0,b.reproject)(y()(a[0]),X(e.props.map),"EPSG:4326")),uom:e.props.uom,type:"length"}]:[]));var m=_({},u);if(e.props.measurement.lineMeasureEnabled){var c=m.geometry.coordinates,g=(0,b.transformLineToArcs)(c);if(!e.props.measurement.disableLabels){e.removeLastSegment();for(var d=0;d<c.length-1;++d){var f=g[100*d+50];f&&(e.textLabels[e.segmentOverlays.length-c.length+1+d].position=f,e.segmentOverlays[e.segmentOverlays.length-c.length+1+d].setPosition((0,b.pointObjectToArray)((0,b.reproject)(f,"EPSG:4326",X(e.props.map)))))}}m=(0,O.t8)("geometry.coordinates",g,m)}else!e.props.measurement.disableLabels&&e.props.measurement.areaMeasureEnabled&&(e.textLabels.splice(e.segmentOverlays.length-2,1),e.props.map.removeOverlay(e.segmentOverlays[e.segmentOverlays.length-2]),e.segmentOverlayElements[e.segmentOverlays.length-2].parentNode.removeChild(e.segmentOverlayElements[e.segmentOverlays.length-2]),e.segmentOverlayElements.splice(e.segmentOverlays.length-2,1),e.segmentOverlays.splice(e.segmentOverlays.length-2,1));var v="bearing"===(null===(r=u.properties.values[0])||void 0===r?void 0:r.type)?"Bearing":u.geometry.type;if(u.geometry.textLabels=e.textLabels.filter((function(t){return t.type===v&&t.textId===e.textId})).map((function(e){return e.textId,e.type,function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,N)})),e.props.changeGeometry([].concat(R(n),[u])),e.props.setTextLabels(R(e.textLabels)),e.addFeature(m),!e.props.measurement.disableLabels&&(y()(e.measureTooltipElements).className="tooltip tooltip-static",y()(e.measureTooltips).setOffset([0,-7]),"Polygon"===e.props.measurement.geomType&&(e.measureTooltipElements[e.measureTooltipElements.length-2].className="tooltip tooltip-static",e.measureTooltips[e.measureTooltipElements.length-2].setOffset([0,-7])),e.segmentOverlayElements))for(var h=0;h<e.segmentOverlayElements.length;++h)e.segmentOverlayElements[h]&&(e.segmentOverlayElements[h].className="segment-overlay segment-overlay-static");(0,k.B)(e.listener),e.curPolygonLength=void 0,e.curLineStringLength=void 0,e.discardDrawState()})),e.props.map.addInteraction(r),e.createHelpTooltip(),e.drawInteraction=r,e.measureLayer=e.vector})),K(J(e),"removeLastSegment",(function(){e.textLabels.pop(),e.segmentLengths.pop(),e.props.map.removeOverlay(y()(e.segmentOverlays)),y()(e.segmentOverlayElements).parentNode.removeChild(y()(e.segmentOverlayElements)),e.segmentOverlays.pop(),e.segmentOverlayElements.pop()})),K(J(e),"removeDrawInteraction",(function(){null!==e.drawInteraction&&(e.removeHelpTooltip(),e.props.map.removeInteraction(e.drawInteraction),e.drawInteraction=null,e.sketchFeature=null,e.props.map.un("click",(function(){return e.updateMeasurementResults(e.props)}),J(e)),(0,k.B)(e.clickListener),e.props.updateOnMouseMove&&e.props.map.un("pointermove",(function(){return e.updateMeasurementResults(e.props)}),J(e)))})),K(J(e),"pointerMoveHandler",(function(e){if(!e.dragging){var t=(0,E.S$)(this.context.messages,"measureSupport.startDrawing");if(this.sketchFeature&&this.drawing){var r=this.sketchFeature.getGeometry();r instanceof S.ZP?t=this.continuePolygonMsg:r instanceof P.Z&&(t=this.continueLineMsg)}this.helpTooltipElement.innerHTML=t,this.helpTooltip.setPosition(e.coordinate),this.helpTooltipElement.classList.remove("hidden")}})),K(J(e),"updateMeasurementResults",(function(t){if(e.sketchFeature){var r=e.sketchFeature.getGeometry().getCoordinates();if("Bearing"===t.measurement.geomType&&r.length>1&&r.length>2){for(e.drawInteraction.sketchCoords_=[r[0],r[1],r[0]];e.sketchFeature.getGeometry().getCoordinates().length>3;)e.drawInteraction.removeLastPoint();e.sketchFeature.getGeometry().setCoordinates([r[0],r[1]]),e.drawInteraction.sketchFeature_=e.sketchFeature,e.drawInteraction.finishDrawing()}}})),K(J(e),"reprojectedCoordinatesFrom4326",(function(t){return t.map((function(t){var r=(0,b.reproject)(t,"EPSG:4326",X(e.props.map));return[r.x,r.y]}))})),K(J(e),"reprojectedCoordinatesIn4326",(function(t){return t.map((function(t){var r=(0,b.reproject)(t,X(e.props.map),"EPSG:4326");return[r.x,r.y]}))})),K(J(e),"calculateGeodesicArea",(function(t){if(t.length>=4){var r=e.reprojectedCoordinatesIn4326(t);return Math.abs((0,B.bg)(new S.ZP([r]),{projection:"EPSG:4326"}))}return 0})),K(J(e),"createHelpTooltip",(function(){e.removeHelpTooltip(),e.helpTooltipElement=document.createElement("div"),e.helpTooltipElement.className="tooltip hidden",e.helpTooltip=new j.Z({element:e.helpTooltipElement,offset:[15,0],positioning:"center-left"}),e.props.map.addOverlay(e.helpTooltip)})),K(J(e),"createMeasureTooltip",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,-15];e.measureTooltipElements||(e.measureTooltipElements=[]),e.measureTooltips||(e.measureTooltips=[]),e.outputValues||(e.outputValues=[]);var r=document.createElement("div");r.className="tooltip tooltip-measure",r.style.display=e.props.measurement.showLabel?"":"none",e.measureTooltipElements.push(r);var n=new j.Z({element:r,offset:t,positioning:"bottom-center"});e.props.map.addOverlay(n),e.measureTooltips.push(n),e.outputValues.push(null)})),K(J(e),"createSegmentLengthOverlay",(function(t){e.segmentOverlayElements||(e.segmentOverlayElements=[]),e.segmentOverlays||(e.segmentOverlays=[]);var r=document.createElement("div");r.className="segment-overlay",r.style.display=e.props.measurement.showSegmentLengths&&!t?"":"none",e.segmentOverlayElements.push(r);var n=new j.Z({element:r,offset:[0,0],positioning:"center-center"});e.props.map.addOverlay(n),e.segmentOverlays.push(n)})),K(J(e),"formatLengthValue",(function(t,r,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(n)return(0,L.rp)(t,o);var a=r&&r.length,s=a.label,l=a.unit,u=i()((0,L.Ov)(t,"m",l),2);return e.props.formatNumber(u)+" "+s})),K(J(e),"formatAreaValue",(function(t,r){var n=r&&r.area,o=n.label,a=n.unit,s=i()((0,L.Ov)(t,"sqm",a),2);return e.props.formatNumber(s)+" "+o})),K(J(e),"removeHelpTooltip",(function(){e.helpTooltipElement&&e.helpTooltipElement.parentNode&&e.helpTooltipElement.parentNode.removeChild(e.helpTooltipElement),e.helpTooltip&&e.props.map.removeOverlay(e.helpTooltip)})),K(J(e),"removeMeasureTooltips",(function(){(e.measureTooltips||[]).forEach((function(t){e.props.map.removeOverlay(t)}));for(var t=document.getElementsByClassName("tooltip-static")||[],r=0;r<t.length;r++)t[r].parentNode.removeChild(t[r]);t=document.getElementsByClassName("tooltip-measure")||[];for(var n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n]);e.measureTooltips=[],e.measureTooltipElements=[],e.outputValues=[]})),K(J(e),"removeSegmentLengthOverlays",(function(){(e.segmentOverlays||[]).forEach((function(t){e.props.map.removeOverlay(t)})),(e.segmentOverlayElements||[]).forEach((function(e){e.parentNode.removeChild(e)})),e.segmentOverlays=[],e.segmentOverlayElements=[]})),e}return t=s,(r=[{key:"UNSAFE_componentWillMount",value:function(){this.props.measurement.geomType&&(this.props.measurement.lineMeasureEnabled||this.props.measurement.areaMeasureEnabled||this.props.measurement.bearingMeasureEnabled)&&h()(this.drawControl)&&this.props.enabled&&this.addDrawInteraction(this.props)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(this.measureTooltipElements&&e.measurement.showLabel!==this.props.measurement.showLabel)for(var t=0;t<this.measureTooltipElements.length;++t)this.measureTooltipElements[t]&&(this.measureTooltipElements[t].style.display=e.measurement.showLabel?"":"none");if(this.segmentOverlayElements&&e.measurement.showSegmentLengths)for(var r=0;r<this.segmentOverlayElements.length;++r)this.segmentOverlayElements[r]&&(this.segmentOverlayElements[r].style.display=e.measurement.showSegmentLengths?"":"none");(e.measurement.geomType&&e.measurement.geomType!==this.props.measurement.geomType||e.measurement.geomType&&(e.measurement.lineMeasureEnabled||e.measurement.areaMeasureEnabled||e.measurement.bearingMeasureEnabled)&&!this.props.enabled&&e.enabled)&&(this.restoreDrawState(),this.addDrawInteraction(e)),e.measurement.geomType||(this.cleanupMeasures(e),e.measurement.features&&e.measurement.features.length>0&&this.props.changeGeometry([]),e.measurement.textLabels&&e.measurement.textLabels.length>0&&this.props.setTextLabels([]));var n=this.props.measurement.features,o=e.measurement.features;e.measurement.updatedByUI&&!c()(n,o)?this.updateFeatures(e):e.measurement.updatedByUI&&!c()(this.props.uom,e.uom)&&this.updateMeasures(e)}},{key:"componentWillUnmount",value:function(){this.cleanupMeasures()}},{key:"render",value:function(){return null}}])&&$(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().Component);K(Y,"propTypes",{startEndPoint:s().object,map:s().object,measurement:s().object,enabled:s().bool,uom:s().object,formatNumber:s().func,changeMeasurementState:s().func,updateMeasures:s().func,resetGeometry:s().func,changeGeometry:s().func,updateOnMouseMove:s().bool,setTextLabels:s().func}),K(Y,"contextTypes",{messages:s().object}),K(Y,"defaultProps",{changeMeasurementState:function(){},resetGeometry:function(){},updateMeasures:function(){},changeGeometry:function(){},formatNumber:function(e){return e},setTextLabels:function(){},startEndPoint:{startPointOptions:{radius:3,fillColor:"green",applyToPolygon:!0},endPointOptions:{radius:3,fillColor:"red",applyToPolygon:!0}},updateOnMouseMove:!1})}}]);